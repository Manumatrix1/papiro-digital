<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="project-name-title">Cargando Tablero...</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f0f0f; }
        .pdf-card { transition: transform 0.2s ease-in-out; background-color: #181818; }
        .pdf-card:hover { transform: translateY(-5px); }
    </style>
</head>
<body class="text-white flex flex-col min-h-screen">
    <header class="bg-[#181818] border-b border-[#2a2a2a] py-3 px-6 flex justify-between items-center">
        <div class="flex items-center gap-4">
            <a href="mi_tablero.html" class="flex items-center text-gray-400 hover:text-white transition group">
                <i class="fas fa-arrow-left"></i>
                <span class="ml-2 font-medium hidden sm:inline">Volver a Mis Tableros</span>
            </a>
            <h1 id="project-name-header" class="text-xl font-bold text-white truncate">Cargando...</h1>
        </div>
        <button id="logout-btn" class="text-gray-400 hover:text-white transition">Cerrar Sesión</button>
    </header>

    <main class="flex-1 p-6">
        <div class="w-full max-w-4xl mx-auto">
            <div id="pdf-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
                <div id="upload-card" class="pdf-card flex flex-col items-center justify-center rounded-lg p-6 border-2 border-dashed border-gray-600 transition hover:bg-[#2a2a2a] cursor-pointer" style="aspect-ratio: 1/1;">
                    <i class="fas fa-plus fa-2x text-gray-400"></i>
                    <span class="mt-4 font-semibold text-gray-400 text-center">Añadir PDF</span>
                </div>
                <input type="file" id="pdf-file-input" class="hidden" accept="application/pdf">
            </div>
            <div id="no-pdfs-message" class="text-gray-400 text-center mt-8 hidden">
                <p>Este tablero no tiene archivos PDF. ¡Sube el primero!</p>
            </div>
        </div>
    </main>

    <script type="module">
        import { auth, db, storage } from './firebase-config.js';
        import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-auth.js";
        import { doc, getDoc, collection, onSnapshot, setDoc } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore.js";
        import { ref, uploadBytesResumable, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-storage.js";

        // ARREGLO: Envolvemos todo en DOMContentLoaded para asegurar que el HTML esté listo.
        document.addEventListener('DOMContentLoaded', () => {
            const projectNameTitle = document.getElementById('project-name-title');
            const projectNameHeader = document.getElementById('project-name-header');
            const pdfGrid = document.getElementById('pdf-grid');
            const uploadCard = document.getElementById('upload-card');
            const pdfFileInput = document.getElementById('pdf-file-input');
            const noPdfsMessage = document.getElementById('no-pdfs-message');
            const logoutBtn = document.getElementById('logout-btn');

            let currentUser, projectId, projectRef;

            onAuthStateChanged(auth, (user) => {
                if (user) {
                    currentUser = user;
                    const urlParams = new URLSearchParams(window.location.search);
                    projectId = urlParams.get('id');
                    if (!projectId) { window.location.href = 'mi_tablero.html'; return; }
                    
                    projectRef = doc(db, "users", currentUser.uid, "projects", projectId);
                    loadProjectName();
                    loadPdfs();

                    uploadCard.addEventListener('click', () => pdfFileInput.click());
                    pdfFileInput.addEventListener('change', handlePdfUpload);
                    logoutBtn.addEventListener('click', () => signOut(auth).then(() => window.location.href = 'index.html'));

                } else {
                    window.location.href = 'index.html';
                }
            });

            async function loadProjectName() { /* ... el resto de las funciones sin cambios ... */ }
            function loadPdfs() { /* ... */ }
            async function handlePdfUpload(e) { /* ... */ }
        });
    </script>
</body>
</html>
