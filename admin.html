<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Papiro Digital</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f0f0f; }
    </style>
</head>
<body class="text-white">
    <div id="app-loader" class="fixed inset-0 bg-[#0f0f0f] flex items-center justify-center z-50">
        <p>Verificando permisos de administrador...</p>
    </div>

    <div id="app-content" class="min-h-screen bg-gradient-to-b from-[#1c1c1c] to-[#0f0f0f] px-4 sm:px-6 py-10 hidden">
        <div class="max-w-7xl mx-auto">
            <header class="mb-12 flex justify-between items-center">
                <div class="flex items-center gap-4">
                    <img src="https://i.postimg.cc/g0HxbpQF/PAPIRO-1.png" alt="Logo de Papiro Digital" class="h-16 w-auto">
                    <div>
                        <h1 class="text-4xl font-bold text-white">Panel de Administrador</h1>
                        <p id="user-email" class="text-yellow-400 text-sm font-semibold"></p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <a href="panel.html" class="bg-gray-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-gray-700 transition">Ver como Usuario</a>
                    <button id="sign-out-btn" class="bg-red-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-red-700 transition">Cerrar Sesión</button>
                </div>
            </header>

            <!-- Estadísticas Principales -->
            <section class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
                <div class="bg-[#181818] p-6 rounded-2xl border border-[#2a2a2a]">
                    <h3 class="text-lg font-semibold text-gray-400">Total de Usuarios</h3>
                    <p id="stats-total-users" class="text-4xl font-bold text-white">0</p>
                </div>
                <div class="bg-[#181818] p-6 rounded-2xl border border-[#2a2a2a]">
                    <h3 class="text-lg font-semibold text-gray-400">Proyectos Creados</h3>
                    <p class="text-4xl font-bold text-white">Próximamente</p>
                </div>
                <div class="bg-[#181818] p-6 rounded-2xl border border-[#2a2a2a]">
                    <h3 class="text-lg font-semibold text-gray-400">Sistema de Pagos</h3>
                    <p class="text-2xl font-bold text-green-400">Próximamente</p>
                </div>
            </section>

            <!-- Lista de Usuarios -->
            <section>
                <h2 class="text-3xl font-semibold text-white mb-6">Usuarios Registrados</h2>
                <div class="bg-[#181818] rounded-2xl border border-[#2a2a2a] overflow-hidden">
                    <table class="min-w-full divide-y divide-gray-700">
                        <thead class="bg-[#2a2a2a]">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Email</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">ID de Usuario</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Fecha de Creación</th>
                            </tr>
                        </thead>
                        <tbody id="users-table-body" class="divide-y divide-gray-800">
                            <!-- Filas de usuarios se insertarán aquí -->
                        </tbody>
                    </table>
                </div>
            </section>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        // ¡OJO! No podemos listar usuarios desde el cliente. Esto es una simulación.
        // La lista real de usuarios se debe obtener desde un backend seguro (Cloud Functions).

        const firebaseConfig = {
           apiKey: "AIzaSyDhcJyTriTBrEDftDx_lYAhFgd6Y8Us4dA",
  authDomain: "papirodigital-1a6c5.firebaseapp.com",
  projectId: "papirodigital-1a6c5",
  storageBucket: "papirodigital-1a6c5.firebasestorage.app",
  messagingSenderId: "274494841235",
  appId: "1:274494841235:web:99112dde1c6dbd12240866",
  measurementId: "G-0SKBCYEEF0"
        };
        

        const signOutBtn = document.getElementById('sign-out-btn');
        const userEmailP = document.getElementById('user-email');
        const appLoader = document.getElementById('app-loader');
        const appContent = document.getElementById('app-content');
        const statsTotalUsers = document.getElementById('stats-total-users');
        const usersTableBody = document.getElementById('users-table-body');

        onAuthStateChanged(auth, (user) => {
            if (user) {
                // El usuario está logueado. Ahora verificamos si es admin.
                user.getIdTokenResult().then(idTokenResult => {
                    // La propiedad 'admin' la seteamos nosotros con una Cloud Function.
                    if (!!idTokenResult.claims.admin) {
                        // ¡Es admin! Mostramos el contenido.
                        userEmailP.textContent = `Admin: ${user.email}`;
                        appLoader.style.display = 'none';
                        appContent.classList.remove('hidden');
                        // Aquí llamaríamos a una función segura para cargar los datos del admin.
                        loadAdminData();
                    } else {
                        // No es admin. Redirigir al panel de usuario normal.
                        alert("Acceso denegado. No tenés permisos de administrador.");
                        window.location.replace('panel.html');
                    }
                });
            } else {
                // El usuario no está logueado. Redirigir al inicio.
                window.location.replace('index.html');
            }
        });
        
        signOutBtn.addEventListener('click', () => {
            signOut(auth).catch(error => console.error("Error al cerrar sesión:", error));
        });

        function loadAdminData() {
            // **IMPORTANTE:** En un proyecto real, esta función haría una llamada
            // a una Cloud Function segura para obtener la lista de usuarios.
            // Por seguridad, Firebase no permite listar todos los usuarios desde el cliente.
            // Lo que sigue es una demostración con datos de ejemplo.
            
            console.warn("ADVERTENCIA: La lista de usuarios es simulada. Se requiere un backend para obtener datos reales.");

            const demoUsers = [
                { email: auth.currentUser.email, uid: auth.currentUser.uid, creationTime: new Date().toLocaleDateString() },
                { email: "usuario.ejemplo@test.com", uid: "abc123xyz456", creationTime: "Ayer" },
                { email: "otro.usuario@test.com", uid: "def456uvw789", creationTime: "Hace una semana" }
            ];

            statsTotalUsers.textContent = demoUsers.length;
            usersTableBody.innerHTML = '';

            demoUsers.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-white">${user.email}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">${user.uid}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">${user.creationTime}</td>
                `;
                usersTableBody.appendChild(row);
            });
        }
    </script>
</body>
</html>
