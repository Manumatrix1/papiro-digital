<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Espacio de Trabajo - Papiro Digital</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f0f0f; }
        #pdf-render { box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        #pdf-loader-container { display: none; }
    </style>
</head>
<body class="text-white">
    <header class="bg-[#181818] border-b border-[#2a2a2a] py-3 px-8 flex justify-between items-center sticky top-0 z-10">
        <div class="flex-1">
            <a href="mi_tablero.html" class="text-sm text-gray-400 hover:text-white transition">← Volver al Tablero</a>
            <input id="project-title" type="text" class="bg-transparent text-2xl font-bold text-white focus:outline-none w-full mt-1" value="Cargando...">
        </div>
        <div class="flex items-center gap-4">
            <button id="save-btn" class="bg-[#88c999] text-[#1C1C1C] font-bold py-2 px-4 rounded-lg hover:brightness-110 transition">Guardar Título</button>
        </div>
    </header>

    <main class="p-8">
        <div id="upload-container" class="mb-4 text-center py-10 border-2 border-dashed border-gray-700 rounded-lg">
            </div>

        <div id="viewer-container" class="hidden">
            <div class="bg-[#181818] p-2 rounded-lg mb-4 flex items-center justify-center gap-6">
                <div class="flex items-center gap-2">
                    <button id="prev-page" class="bg-gray-700 hover:bg-gray-600 font-bold p-2 rounded-lg transition">◀</button>
                    <span>Página <span id="page-num"></span> de <span id="page-count"></span></span>
                    <button id="next-page" class="bg-gray-700 hover:bg-gray-600 font-bold p-2 rounded-lg transition">▶</button>
                </div>
                <div class="flex items-center gap-2">
                    <input type="search" id="search-input" placeholder="Buscar en PDF..." class="bg-gray-700 text-white px-3 py-1.5 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#88c999]">
                    <button id="search-btn" class="bg-blue-600 hover:bg-blue-500 font-bold py-1.5 px-4 rounded-lg transition">Buscar</button>
                </div>
            </div>
            <div class="flex justify-center">
                <canvas id="pdf-render"></canvas>
            </div>
        </div>
    </main>
    
    <script src="https://mozilla.github.io/pdf.js/build/pdf.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytesResumable, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-storage.js";

        // ... (código de inicialización de Firebase y selectores de elementos sin cambios) ...
        const searchInput = document.getElementById('search-input');
        const searchBtn = document.getElementById('search-btn');

        // ... (código del lector de PDF y carga de proyecto sin cambios) ...

        // --- LÓGICA DEL BUSCADOR ---
        async function searchInPdf() {
            const searchText = searchInput.value;
            if (!searchText || !pdfDoc) return;

            searchBtn.textContent = "Buscando...";
            const numPages = pdfDoc.numPages;
            const foundPages = [];

            for (let i = 1; i <= numPages; i++) {
                const page = await pdfDoc.getPage(i);
                const textContent = await page.getTextContent();
                const pageText = textContent.items.map(item => item.str).join(' ');
                
                if (pageText.toLowerCase().includes(searchText.toLowerCase())) {
                    foundPages.push(i);
                }
            }

            searchBtn.textContent = "Buscar";
            if (foundPages.length > 0) {
                alert(`Se encontró "${searchText}" en las páginas: ${foundPages.join(', ')}`);
            } else {
                alert(`No se encontraron resultados para "${searchText}".`);
            }
        }

        searchBtn.addEventListener('click', searchInPdf);
        searchInput.addEventListener('keyup', (event) => {
            if (event.key === 'Enter') {
                searchInPdf();
            }
        });

    </script>
    </body>
</html>
